trigger:
  branches:
    include:
      - master  # Branch que ser√° usada como trigger na pipeline

jobs:
  - job: build
    displayName: 'Build and Push Docker Image to Docker Hub'
    pool:
      name: 'Ryzen-Neto-Local'  # Agente local que vai rodar o pipeline
    steps:
      - script: |
          "C:\Program Files\Docker\Docker\resources\bin\docker.exe" version
          "C:\Program Files\Docker\Docker\resources\bin\docker.exe" login -u %DOCKER_USERNAME% -p %DOCKER_PASSWORD%
          if %ERRORLEVEL% NEQ 0 exit /b 1
          "C:\Program Files\Docker\Docker\resources\bin\docker.exe" buildx build --platform linux/amd64 -f $(Build.SourcesDirectory)\Dockerfile -t jpneto90/unyleya_projeto_devops:latest --push .
        displayName: 'Build and Push Docker Image'
        env:
          DOCKER_USERNAME: $(DOCKER_USERNAME)
          DOCKER_PASSWORD: $(DOCKER_PASSWORD)
